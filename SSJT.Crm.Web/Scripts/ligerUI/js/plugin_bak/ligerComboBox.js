if(typeof(LigerUIManagers)=="undefined"){LigerUIManagers={}}(function(A){A.fn.ligerGetComboBoxManager=function(){return LigerUIManagers[this[0].id+"_ComboBox"]};A.fn.ligerRemoveComboBoxManager=function(){return this.each(function(){LigerUIManagers[this.id+"_ComboBox"]=null})};A.fn.ligerComboBox=function(B){B=B||{};B=A.extend({resize:true,isMultiSelect:false,isShowCheckBox:false,columns:false,selectBoxWidth:false,selectBoxHeight:false,onBeforeSelect:false,onSelected:false,initValue:null,initText:null,valueField:"id",textField:"text",valueFieldID:null,split:";"},B);if(B.columns){B.isShowCheckBox=true}if(B.isMultiSelect){B.isShowCheckBox=true}return this.each(function(){if(this.usedComboBox){return}if(this.id==undefined){this.id="LigerUI_"+new Date().getTime()}var E={findTextByValue:function(F){if(F==undefined){return""}var G="";A(B.data).each(function(I,J){var K=J[B.valueField];var H=J[B.textField];if(F==K){G+=H+B.split}});if(G.length>0){G=G.substr(0,G.length-1)}return G},findValueByText:function(G){if(!G&&G==""){return""}var F="";A(B.data).each(function(I,J){var K=J[B.valueField];var H=J[B.textField];if(G==H){F+=K+B.split}});if(F.length>0){F=F.substr(0,F.length-1)}return F},bulidContent:function(){this.clearContent();if(E.select){this.setSelect()}else{if(B.data){this.setData(B.data)}}},clearContent:function(){A("table",E.selectBox).html("");E.inputText.val("");E.valueField.val("")},setSelect:function(){this.clearContent();A("option",E.select).each(function(G){var H=A(this).val();var F=A(this).html();A("table.l-table-nocheckbox",E.selectBox).append("<tr><td index='"+G+"' value='"+H+"'>"+F+"</td>")});A("td:eq("+E.select[0].selectedIndex+")",E.selectBox).each(function(){if(A(this).hasClass("l-selected")){E.selectBox.hide();return}A(".l-selected",E.selectBox).removeClass("l-selected");A(this).addClass("l-selected");if(E.select[0].selectedIndex!=A(this).attr("index")&&E.select[0].onchange){E.select[0].selectedIndex=A(this).attr("index");E.select[0].onchange()}var F=parseInt(A(this).attr("index"));E.select[0].selectedIndex=F;E.select.trigger("change");E.selectBox.hide();E.inputText.val(A(this).html())});D.addClickEven()},setData:function(L){this.clearContent();if(B.columns){E.selectBox.table.headrow=A("<tr class='l-table-headerow'><td width='18px'></td></tr>");E.selectBox.table.append(E.selectBox.table.headrow);E.selectBox.table.addClass("l-box-select-grid");for(var J=0;J<B.columns.length;J++){var I=A("<td columnindex='"+J+"' columnname='"+B.columns[J].name+"'>"+B.columns[J].header+"</td>");if(B.columns[J].width){I.width(B.columns[J].width)}E.selectBox.table.headrow.append(I)}}for(var F=0;F<L.length;F++){var K=L[F][B.valueField];var G=L[F][B.textField];if(!B.columns){A("table.l-table-checkbox",E.selectBox).append("<tr><td style='width:18px;'  index='"+F+"' value='"+K+"' text='"+G+"' ><input type='checkbox' /></td><td index='"+F+"' value='"+K+"' align='left'>"+G+"</td>");A("table.l-table-nocheckbox",E.selectBox).append("<tr><td index='"+F+"' value='"+K+"' align='left'>"+G+"</td>")}else{var H=A("<tr><td style='width:18px;'  index='"+F+"' value='"+K+"' text='"+G+"' ><input type='checkbox' /></td></tr>");A("td",E.selectBox.table.headrow).each(function(){var N=A(this).attr("columnname");if(N){var M=A("<td>"+L[F][N]+"</td>");H.append(M)}});E.selectBox.table.append(H)}}if(B.isShowCheckBox&&A.fn.ligerCheckBox){A("table input:checkbox",E.selectBox).ligerCheckBox()}A(".l-table-checkbox input:checkbox",E.selectBox).change(function(){if(this.checked&&B.onBeforeSelect){var M=null;if(A(this).parent().get(0).tagName.toLowerCase()=="div"){M=A(this).parent().parent()}else{M=A(this).parent()}if(M!=null&&!B.onBeforeSelect(M.attr("value"),M.attr("text"))){E.selectBox.slideToggle("fast");return false}}if(!B.isMultiSelect){if(this.checked){A("input:checked",E.selectBox).not(this).each(function(){this.checked=false;A(".l-checkbox-checked",A(this).parent()).removeClass("l-checkbox-checked")});E.selectBox.slideToggle("fast")}}D.changeValue()});D.addClickEven()},inputText:null,select:null,textFieldID:"",valueFieldID:"",valueField:null};var D={init:function(){var F=null;if(B.initValue!=undefined){F=B.initValue;var G=E.findTextByValue(F);E.inputText.val(G);E.valueField.val(F);D.onChangedValue(F,G)}else{if(B.initText!=undefined){F=E.findValueByText(B.initText);E.inputText.val(B.initText);E.valueField.val(F);D.onChangedValue(F,B.initText)}}if(!B.isShowCheckBox&&F!=null){A("table tr",E.selectBox).find("td:first").each(function(){if(F==A(this).attr("value")){A(this).addClass("l-selected")}})}if(B.isShowCheckBox&&F!=null){A(":checkbox",E.selectBox).each(function(){var I=null;if(A(this).parent().get(0).tagName.toLowerCase()=="div"){I=A(this).parent().parent()}else{I=A(this).parent()}if(I==null){return}var H=F.toString().split(B.split);A(H).each(function(J,K){if(K==I.attr("value")){A(".l-checkbox",I).addClass("l-checkbox-checked")}})})}},onChangedValue:function(G,F){E.selectedText=F;E.selectedValue=G;if(B.onSelected){B.onSelected(G,F)}},changeValue:function(){var G="";var F="";A("input:checked",E.selectBox).each(function(){var H=null;if(A(this).parent().get(0).tagName.toLowerCase()=="div"){H=A(this).parent().parent()}else{H=A(this).parent()}if(!H){return}G+=H.attr("value")+B.split;F+=H.attr("text")+B.split});if(G.length>0){G=G.substr(0,G.length-1)}if(F.length>0){F=F.substr(0,F.length-1)}E.valueField.val(G);E.inputText.val(F);D.onChangedValue(G,F)},addClickEven:function(){A(".l-table-nocheckbox td",E.selectBox).click(function(){if(B.onBeforeSelect&&!B.onBeforeSelect(A(this).attr("value"),A(this).html())){E.selectBox.slideToggle("fast");return false}if(A(this).hasClass("l-selected")){E.selectBox.slideToggle("fast");return}A(".l-selected",E.selectBox).removeClass("l-selected");A(this).addClass("l-selected");if(E.select){if(E.select[0].selectedIndex!=A(this).attr("index")){var F=parseInt(A(this).attr("index"));E.select[0].selectedIndex=F;E.select.trigger("change")}}E.boxToggling=true;E.selectBox.hide("fast",function(){E.boxToggling=false});E.inputText.val(A(this).html());E.valueField.val(A(this).attr("value"));D.onChangedValue(A(this).attr("value"),A(this).html())})},toggleSelectBox:function(G){var F=E.wrapper.height();E.boxToggling=true;if(G){E.selectBox.hide("fast",function(){E.boxToggling=false})}else{if(E.wrapper.offset().top+E.selectBox.height()+F+4-A(window).scrollTop()>A(window).height()){E.selectBox.css("marginTop",-1*(E.selectBox.height()+F+5))}E.selectBox.show("fast",function(){E.boxToggling=false;if(!B.isShowCheckBox){var H=(A("td.l-selected",E.selectBox).offset().top-E.selectBox.offset().top);A(".l-box-select-inner",E.selectBox).animate({scrollTop:H})}})}E.isShowed=E.selectBox.is(":visible")}};if(this.tagName.toLowerCase()=="input"){this.readOnly=true;E.inputText=A(this);E.textFieldID=this.id}else{if(this.tagName.toLowerCase()=="select"){A(this).addClass("l-hidden");E.select=A(this);B.isMultiSelect=false;B.isShowCheckBox=false;E.textFieldID=this.id+"_txt";E.inputText=A('<input type="text" readonly="true"/>');E.inputText.attr("id",E.textFieldID).insertAfter(A(this))}else{return}}if(E.inputText[0].name==undefined){E.inputText[0].name=E.textFieldID}E.valueField=null;if(B.valueFieldID){E.valueField=A("#"+B.valueFieldID+":input");if(E.valueField.length==0){E.valueField=A('<input type="hidden"/>')}E.valueField[0].id=E.valueField[0].name=B.valueFieldID}else{E.valueField=A('<input type="hidden"/>');E.valueField[0].id=E.valueField[0].name=E.textFieldID+"_val"}if(E.valueField[0].name==undefined){E.valueField[0].name=E.valueField[0].id}E.link=A('<div class="l-trigger"><div class="l-trigger-icon"></div></div>');E.selectBox=A('<div class="l-box-select"><div class="l-box-select-inner"><table cellpadding="0" cellspacing="0" border="0"></table></div></div>');E.selectBox.table=A("table",E.selectBox);E.wrapper=E.inputText.wrap('<div class="l-text"></div>').parent();E.wrapper.append(E.link).after(E.selectBox).after(E.valueField);if(!E.inputText.hasClass("l-text-field")){E.inputText.addClass("l-text-field")}if(B.width){E.wrapper.css({width:B.width});E.inputText.css({width:B.width-20})}if(B.height){E.wrapper.height(B.height);E.inputText.height(B.height-2);E.link.height(B.height-4)}if(B.isShowCheckBox&&!E.select){A("table",E.selectBox).addClass("l-table-checkbox")}else{A("table",E.selectBox).addClass("l-table-nocheckbox")}if(B.resize&&A.fn.ligerResizable){E.selectBox.ligerResizable({handles:"se,s",onStartResize:function(){E.resizing=true},onStopResize:function(){E.resizing=false}});E.selectBox.append("<div class='l-btn-nw-drop'></div>")}E.link.hover(function(){this.className="l-trigger-hover"},function(){this.className="l-trigger"}).mousedown(function(){this.className="l-trigger-pressed"}).mouseup(function(){this.className="l-trigger-hover"}).click(function(){D.toggleSelectBox(E.selectBox.is(":visible"))});E.inputText.click(function(){D.toggleSelectBox(E.selectBox.is(":visible"))});E.resizing=false;E.selectBox.hover(null,function(F){if(E.selectBox.is(":visible")&&!E.boxToggling&&!E.resizing){D.toggleSelectBox(true)}});E.bulidContent();D.init();if(B.selectBoxWidth){E.selectBox.width(B.selectBoxWidth)}else{E.selectBox.css("width",E.wrapper.css("width"))}var C=A("tr",E.selectBox.table).length;if(!B.selectBoxHeight&&C<8){B.selectBoxHeight=C*30}if(B.selectBoxHeight){E.selectBox.height(B.selectBoxHeight)}if(this.id==undefined){this.id="LigerUI_"+new Date().getTime()}LigerUIManagers[this.id+"_ComboBox"]=E;this.usedComboBox=true})}})(jQuery);